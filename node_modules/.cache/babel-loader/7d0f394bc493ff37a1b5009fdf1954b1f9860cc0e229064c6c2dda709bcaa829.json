{"ast":null,"code":"import _objectSpread from \"/Users/codinggents/Documents/lambdaforge/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { HttpRequest } from \"@smithy/protocol-http\";\nconst TRACE_ID_HEADER_NAME = \"X-Amzn-Trace-Id\";\nconst ENV_LAMBDA_FUNCTION_NAME = \"AWS_LAMBDA_FUNCTION_NAME\";\nconst ENV_TRACE_ID = \"_X_AMZN_TRACE_ID\";\nexport const recursionDetectionMiddleware = options => next => async args => {\n  var _Object$keys$find, _request$headers;\n  const {\n    request\n  } = args;\n  if (!HttpRequest.isInstance(request) || options.runtime !== \"node\") {\n    return next(args);\n  }\n  const traceIdHeader = (_Object$keys$find = Object.keys((_request$headers = request.headers) !== null && _request$headers !== void 0 ? _request$headers : {}).find(h => h.toLowerCase() === TRACE_ID_HEADER_NAME.toLowerCase())) !== null && _Object$keys$find !== void 0 ? _Object$keys$find : TRACE_ID_HEADER_NAME;\n  if (request.headers.hasOwnProperty(traceIdHeader)) {\n    return next(args);\n  }\n  const functionName = process.env[ENV_LAMBDA_FUNCTION_NAME];\n  const traceId = process.env[ENV_TRACE_ID];\n  const nonEmptyString = str => typeof str === \"string\" && str.length > 0;\n  if (nonEmptyString(functionName) && nonEmptyString(traceId)) {\n    request.headers[TRACE_ID_HEADER_NAME] = traceId;\n  }\n  return next(_objectSpread(_objectSpread({}, args), {}, {\n    request\n  }));\n};\nexport const addRecursionDetectionMiddlewareOptions = {\n  step: \"build\",\n  tags: [\"RECURSION_DETECTION\"],\n  name: \"recursionDetectionMiddleware\",\n  override: true,\n  priority: \"low\"\n};\nexport const getRecursionDetectionPlugin = options => ({\n  applyToStack: clientStack => {\n    clientStack.add(recursionDetectionMiddleware(options), addRecursionDetectionMiddlewareOptions);\n  }\n});","map":{"version":3,"names":["HttpRequest","TRACE_ID_HEADER_NAME","ENV_LAMBDA_FUNCTION_NAME","ENV_TRACE_ID","recursionDetectionMiddleware","options","next","args","_Object$keys$find","_request$headers","request","isInstance","runtime","traceIdHeader","Object","keys","headers","find","h","toLowerCase","hasOwnProperty","functionName","process","env","traceId","nonEmptyString","str","length","_objectSpread","addRecursionDetectionMiddlewareOptions","step","tags","name","override","priority","getRecursionDetectionPlugin","applyToStack","clientStack","add"],"sources":["/Users/codinggents/Documents/lambdaforge/node_modules/@aws-sdk/middleware-recursion-detection/dist-es/index.js"],"sourcesContent":["import { HttpRequest } from \"@smithy/protocol-http\";\nconst TRACE_ID_HEADER_NAME = \"X-Amzn-Trace-Id\";\nconst ENV_LAMBDA_FUNCTION_NAME = \"AWS_LAMBDA_FUNCTION_NAME\";\nconst ENV_TRACE_ID = \"_X_AMZN_TRACE_ID\";\nexport const recursionDetectionMiddleware = (options) => (next) => async (args) => {\n    const { request } = args;\n    if (!HttpRequest.isInstance(request) || options.runtime !== \"node\") {\n        return next(args);\n    }\n    const traceIdHeader = Object.keys(request.headers ?? {}).find((h) => h.toLowerCase() === TRACE_ID_HEADER_NAME.toLowerCase()) ??\n        TRACE_ID_HEADER_NAME;\n    if (request.headers.hasOwnProperty(traceIdHeader)) {\n        return next(args);\n    }\n    const functionName = process.env[ENV_LAMBDA_FUNCTION_NAME];\n    const traceId = process.env[ENV_TRACE_ID];\n    const nonEmptyString = (str) => typeof str === \"string\" && str.length > 0;\n    if (nonEmptyString(functionName) && nonEmptyString(traceId)) {\n        request.headers[TRACE_ID_HEADER_NAME] = traceId;\n    }\n    return next({\n        ...args,\n        request,\n    });\n};\nexport const addRecursionDetectionMiddlewareOptions = {\n    step: \"build\",\n    tags: [\"RECURSION_DETECTION\"],\n    name: \"recursionDetectionMiddleware\",\n    override: true,\n    priority: \"low\",\n};\nexport const getRecursionDetectionPlugin = (options) => ({\n    applyToStack: (clientStack) => {\n        clientStack.add(recursionDetectionMiddleware(options), addRecursionDetectionMiddlewareOptions);\n    },\n});\n"],"mappings":";AAAA,SAASA,WAAW,QAAQ,uBAAuB;AACnD,MAAMC,oBAAoB,GAAG,iBAAiB;AAC9C,MAAMC,wBAAwB,GAAG,0BAA0B;AAC3D,MAAMC,YAAY,GAAG,kBAAkB;AACvC,OAAO,MAAMC,4BAA4B,GAAIC,OAAO,IAAMC,IAAI,IAAK,MAAOC,IAAI,IAAK;EAAA,IAAAC,iBAAA,EAAAC,gBAAA;EAC/E,MAAM;IAAEC;EAAQ,CAAC,GAAGH,IAAI;EACxB,IAAI,CAACP,WAAW,CAACW,UAAU,CAACD,OAAO,CAAC,IAAIL,OAAO,CAACO,OAAO,KAAK,MAAM,EAAE;IAChE,OAAON,IAAI,CAACC,IAAI,CAAC;EACrB;EACA,MAAMM,aAAa,IAAAL,iBAAA,GAAGM,MAAM,CAACC,IAAI,EAAAN,gBAAA,GAACC,OAAO,CAACM,OAAO,cAAAP,gBAAA,cAAAA,gBAAA,GAAI,CAAC,CAAC,CAAC,CAACQ,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,WAAW,CAAC,CAAC,KAAKlB,oBAAoB,CAACkB,WAAW,CAAC,CAAC,CAAC,cAAAX,iBAAA,cAAAA,iBAAA,GACxHP,oBAAoB;EACxB,IAAIS,OAAO,CAACM,OAAO,CAACI,cAAc,CAACP,aAAa,CAAC,EAAE;IAC/C,OAAOP,IAAI,CAACC,IAAI,CAAC;EACrB;EACA,MAAMc,YAAY,GAAGC,OAAO,CAACC,GAAG,CAACrB,wBAAwB,CAAC;EAC1D,MAAMsB,OAAO,GAAGF,OAAO,CAACC,GAAG,CAACpB,YAAY,CAAC;EACzC,MAAMsB,cAAc,GAAIC,GAAG,IAAK,OAAOA,GAAG,KAAK,QAAQ,IAAIA,GAAG,CAACC,MAAM,GAAG,CAAC;EACzE,IAAIF,cAAc,CAACJ,YAAY,CAAC,IAAII,cAAc,CAACD,OAAO,CAAC,EAAE;IACzDd,OAAO,CAACM,OAAO,CAACf,oBAAoB,CAAC,GAAGuB,OAAO;EACnD;EACA,OAAOlB,IAAI,CAAAsB,aAAA,CAAAA,aAAA,KACJrB,IAAI;IACPG;EAAO,EACV,CAAC;AACN,CAAC;AACD,OAAO,MAAMmB,sCAAsC,GAAG;EAClDC,IAAI,EAAE,OAAO;EACbC,IAAI,EAAE,CAAC,qBAAqB,CAAC;EAC7BC,IAAI,EAAE,8BAA8B;EACpCC,QAAQ,EAAE,IAAI;EACdC,QAAQ,EAAE;AACd,CAAC;AACD,OAAO,MAAMC,2BAA2B,GAAI9B,OAAO,KAAM;EACrD+B,YAAY,EAAGC,WAAW,IAAK;IAC3BA,WAAW,CAACC,GAAG,CAAClC,4BAA4B,CAACC,OAAO,CAAC,EAAEwB,sCAAsC,CAAC;EAClG;AACJ,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}